webpackJsonp([1],{"5myX":function(e,t){},"7XHC":function(e,t){},"7aKY":function(e,t){},"7zck":function(e,t){},GykT:function(e,t){},ILwI:function(e,t){},NHnr:function(e,t,n){"use strict";function i(e){return{x:e.x+e.width/2,y:e.y+e.height/2}}function o(e,t){return Math.pow(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2),.5)}function r(e){var t=e.rectangles,n=e.point,i=$()(t);if(0===i.length)return null;var r=null,s=Number.POSITIVE_INFINITY;return i.forEach(function(e){var i=function(e){var t=e.rectangle,n=e.point;switch(function(e){var t=e.rectangle,n=e.point;return n.x<t.x?n.y<t.y?1:n.y>t.y+t.height?7:4:n.x>t.x+t.width?n.y<t.y?3:n.y>t.y+t.height?9:6:n.y<t.y?2:n.y>t.y+t.height?8:5}({rectangle:t,point:n})){case 1:return o(n,{x:t.x,y:t.y});case 2:return t.y-n.y;case 3:return o(n,{x:t.x+t.width,y:t.y});case 4:return t.x-n.x;case 5:return 0;case 6:return n.x-(t.x+t.width);case 7:return o(n,{x:t.x,y:t.y+t.height});case 8:return n.y-(t.y+t.height);case 9:return o(n,{x:t.x+t.width,y:t.y+t.height})}}({rectangle:t[e],point:n});i<s&&(r=e,s=i)}),r}function s(e){var t=e.nodes,n=e.sizes,i=e.familySizes,o=e.parentKey,r=e.positions,a=t[o],l=r[o];if(a.children.length>0){var c=i[o],u=l.x+n[o].width+X+c.height*Z,d=void 0;d=(c.othersHeight,n[o].height,l.y-c.othersHeight/2+n[o].height/2),a.children.forEach(function(e){var o=n[e],a=i[e];r[e]={x:u,y:d+a.height/2-o.height/2},d+=a.height,d+=G,s({nodes:t,sizes:n,familySizes:i,parentKey:e,positions:r})})}}function a(e){var t=e.nodes,n=e.sizes,i=e.familySizes,o=e.parentKey,r=t[o];if(r.children.length>0){r.children.forEach(function(e){a({nodes:t,sizes:n,familySizes:i,parentKey:e})});var s=r.children.reduce(function(e,t){var o=i[t].width,r=Math.max(i[t].height,n[t].height);return{width:Math.max(e.width,o),height:e.height+r}},{width:0,height:0});s.height+=G*(r.children.length-1),i[o]={width:n[o].width+s.width+X,height:Math.max(n[o].height,s.height),othersHeight:s.height}}else i[o]=B()({},n[o],{othersHeight:0})}function l(e){var t=e.nodes,n=e.childKey;return $()(t).find(function(e){return-1!==t[e].children.indexOf(n)})||null}function c(e){var t=e.nodes,n=e.parentKey,i=[];return t[n].children.forEach(function(e){i.push(e);var n=c({nodes:t,parentKey:e});i=i.concat(n)}),i}function u(e){var t,n=e.nodes,i=e.parentKey,o=e.newKey,r=void 0===o?"key_"+Math.random():o,s=J(),a=r,l=n[i],c=l.children.concat();c.push(a);return t={},j()(t,a,s),j()(t,i,B()({},l,{children:c})),t}function d(e){var t=e.nodes,n=e.deleteKey,i=c({nodes:t,parentKey:n}),o=j()({},n,null);i.forEach(function(e){o[e]=null});var r=l({nodes:t,childKey:n});if(r){var s=t[r],a=B()({},s);a.children=a.children.filter(function(e){return e!==n}),o[r]=a}return o}function h(e){return B()({},e,{children:e.children.concat()})}function f(e){var t=e.nodes,n=e.targetKey,i=e.newParentKey,o=e.order,r=void 0===o?0:o,s=l({nodes:t,childKey:n}),a=h(t[s]),c=a.children.indexOf(n);if(a.children.splice(c,1),s===i)return r<=c?a.children.splice(r,0,n):a.children.splice(r-1,0,n),B()({},t,j()({},s,a));var u,d=h(t[i]);return d.children.splice(r,0,n),B()({},t,(u={},j()(u,s,a),j()(u,i,d),u))}function v(e){var t=e.nodes,n=!1;return $()(t).some(function(e){if(e!==Y&&!l({nodes:t,childKey:e}))return n=!0;return t[e].children.some(function(e){if(!t[e])return n=!0,!0}),n}),n}Object.defineProperty(t,"__esModule",{value:!0});var g=n("7+uW"),y=n("Dd8w"),m=n.n(y),p=n("Sazm");p.initializeApp({apiKey:"AIzaSyB_t7IC5k4U8bedjSXvpbtsdF6KH5RfpOk",authDomain:"mind-xx-acpr.firebaseapp.com",databaseURL:"https://mind-xx-acpr.firebaseio.com",projectId:"mind-xx-acpr",storageBucket:"mind-xx-acpr.appspot.com",messagingSenderId:"940754615168"});var x=p,_={props:{value:{type:Boolean,required:!0}},methods:{authGoogle:function(){var e=new x.auth.GoogleAuthProvider;x.auth().signInWithRedirect(e)}}},b={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-layout",{attrs:{row:"","justify-center":""}},[i("v-dialog",{attrs:{persistent:"","max-width":"240"},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},[i("v-card",[i("v-card-title",{staticClass:"headline"},[e._v("Need Auth")]),e._v(" "),i("v-card-text",[i("v-btn",{attrs:{color:"white"},on:{click:e.authGoogle}},[i("img",{staticClass:"image",attrs:{src:n("y/zs")}})])],1)],1)],1)],1)},staticRenderFns:[]},w=n("VU/8")(_,b,!1,function(e){n("GykT")},"data-v-6fd0c3a6",null).exports,C=n("NYxO"),k="USER",S="AUTHORITY_LOADING",N="LOAD_USER",E="SIGN_OUT",T="SET_USER",A="SET_AUTHORITY_LOADING",K={name:"app",components:{AuthDialog:w},computed:m()({},Object(C.c)("user",{user:k,authorityLoading:S}),{needAuth:function(){return!this.user}}),mounted:function(){this.loadUser()},methods:m()({},Object(C.b)("user",{loadUser:N}))},O={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",{attrs:{id:"app"}},[e.authorityLoading?e._e():n("router-view"),e._v(" "),n("AuthDialog",{model:{value:e.needAuth,callback:function(t){e.needAuth=t},expression:"needAuth"}})],1)},staticRenderFns:[]},M=n("VU/8")(K,O,!1,function(e){n("vLcZ")},null,null).exports,R=n("/ocq"),D="LEFT_DRAWER",F="SET_LEFT_DRAWER",P="SET_LEFT_DRAWER",L={props:{},computed:m()({},Object(C.c)("layouts",{leftDrawer:D}),Object(C.c)("user",{user:k})),methods:m()({},Object(C.b)("layouts",{setLeftDrawer:F}),Object(C.b)("user",{_signOut:E}),{signOut:function(){this._signOut().then().catch().then(function(){location.reload()})}})},I={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("v-navigation-drawer",{attrs:{fixed:"",clipped:"",app:"",value:e.leftDrawer},on:{input:function(t){return e.setLeftDrawer({leftDrawer:t})}}},[n("router-view",{attrs:{name:"leftDrawer"}})],1),e._v(" "),n("v-toolbar",{attrs:{color:"blue darken-3",dark:"",app:"","clipped-left":"",fixed:"",dense:""}},[n("v-toolbar-title",{staticClass:"ml-0 pl-3",style:e.$vuetify.breakpoint.smAndUp?"width: 300px; min-width: 250px":"min-width: 72px"},[n("v-toolbar-side-icon",{on:{click:function(t){t.stopPropagation(),e.setLeftDrawer({leftDrawer:!e.leftDrawer})}}}),e._v(" "),n("v-btn",{attrs:{flat:""},on:{click:function(t){e.$router.push({name:"WorkSpace"})}}},[e._v("MindXXACPR")])],1),e._v(" "),n("div",{staticClass:"d-flex align-center",staticStyle:{"margin-left":"auto"}},[n("router-view",{attrs:{name:"headerIconList"}}),e._v(" "),e.user?n("v-menu",{attrs:{bottom:"",left:"","offset-y":""}},[n("v-btn",{attrs:{slot:"activator",icon:"",dark:""},slot:"activator"},[n("v-avatar",{attrs:{size:"32px"}},[n("img",{attrs:{src:e.user.photoURL}})])],1),e._v(" "),n("v-list",[n("v-list-tile",[n("v-list-tile-title",[e._v(e._s(e.user.displayName))])],1),e._v(" "),n("v-divider"),e._v(" "),n("v-list-tile",{on:{click:e.signOut}},[n("v-list-tile-title",[e._v("Sign out")])],1)],1)],1):e._e()],1)],1),e._v(" "),n("v-content",{ref:"content"},[n("v-container",{attrs:{fluid:"","fill-height":""}},[n("v-layout",{attrs:{"justify-center":""}},[n("router-view",{attrs:{name:"content"}})],1)],1)],1)],1)},staticRenderFns:[]},U=n("VU/8")(L,I,!1,function(e){n("Wk/c")},"data-v-520a5f56",null).exports,z=n("bOdI"),j=n.n(z),W=n("//Fk"),H=n.n(W),V=n("woOf"),B=n.n(V),Q=n("fZjL"),$=n.n(Q),X=20,G=20,Z=.1,q=5,Y="root",J=function(e){return B()({},{text:"",children:[],backgroundColor:"#B3E5FC",color:"#000000"},e)},ee=function(e,t){return e.text===t.text&&(e.backgroundColor===t.backgroundColor&&(e.color===t.color&&e.children.join("/")===t.children.join("/")))},te=function(){return j()({},Y,J())},ne=function(e){var t=void 0,n=void 0,i=e.currentTarget.getBoundingClientRect(),o=i.left+window.pageXOffset,r=i.top+window.pageYOffset;if(ie(e)){var s=e.touches[0];t=s.pageX-o,n=s.pageY-r}else t=e.pageX-o,n=e.pageY-r;return{x:t,y:n}},ie=function(e){return e.touches},oe={props:{x:{type:Number,default:0},y:{type:Number,default:0},rx:{type:Number,default:0},ry:{type:Number,default:0},width:{type:Number,default:50},height:{type:Number,default:50},strokeWidth:{type:Number,default:1},stroke:{type:String,default:"black"},fill:{type:String,default:"none"},strokeDasharray:{type:Number,default:0},strokeDashoffset:{type:Number,default:0}}},re={render:function(){var e=this.$createElement;return(this._self._c||e)("rect",{attrs:{x:this.x,y:this.y,rx:this.rx,ry:this.ry,width:this.width,height:this.height,stroke:this.stroke,"stroke-width":this.strokeWidth,fill:this.fill,"stroke-dasharray":this.strokeDasharray,"stroke-dashoffset":this.strokeDashoffset}})},staticRenderFns:[]},se=n("VU/8")(oe,re,!1,null,null,null).exports,ae={components:{SvgRectangle:se},data:function(){return{beforeMoveP:null,downStart:0,clickLast:0,rectangleSelecting:!1,downP:null}},props:{x:{type:Number,default:0},y:{type:Number,default:0},width:{type:Number,default:400,validator:function(e){return e>0}},height:{type:Number,default:400,validator:function(e){return e>0}},scale:{type:Number,default:1,validator:function(e){return e>0}}},computed:{canvasWidth:function(){return this.width/this.scale},canvasHeight:function(){return this.height/this.scale},selectRectangle:function(){if(!this.rectangleSelecting||!this.downP||!this.beforeMoveP)return null;var e=this.dom2svg(this.downP),t=this.dom2svg(this.beforeMoveP);return{x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),width:Math.abs(e.x-t.x),height:Math.abs(e.y-t.y)}}},methods:{dom2svg:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return{x:e.x/t+this.x,y:e.y/t+this.y}},dom2svgScale:function(e){return{x:e.x/this.scale,y:e.y/this.scale}},svg2dom:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return{x:(e.x-this.x)*t,y:(e.y-this.y)*t}},canvasCursorMove:function(e){if(this.beforeMoveP){var t=ne(e),n=this.dom2svgScale({x:this.beforeMoveP.x-t.x,y:this.beforeMoveP.y-t.y});this.rectangleSelecting||this.$emit("move",{x:this.x+n.x,y:this.y+n.y}),this.beforeMoveP=B()({},t)}},canvasWheel:function(e){var t=e.wheelDeltaX,n=e.wheelDeltaY;this.$emit("move",{x:this.x-t/3/this.scale,y:this.y-n/3/this.scale})},canvasCursorDownSelf:function(e){this.downStart=Date.now();var t=ne(e);this.beforeMoveP=B()({},t),this.rectangleSelecting=e.shiftKey,this.downP=t},canvasCursorUpSelf:function(e){var t=Date.now();t-this.downStart<300&&(t-this.clickLast<300?this.$emit("doubleClick",e):this.$emit("click",e),this.clickLast=t)},canvasCursorUp:function(e){this.selectRectangle&&this.$emit("selectRectangle",this.selectRectangle),this.beforeMoveP=null,this.rectangleSelecting=!1},getPostionAfterChangeScale:function(e){var t={x:this.width/2,y:this.height/2},n=this.dom2svg(t),i=this.dom2svg(t,e);return{x:this.x+(n.x-i.x),y:this.y+(n.y-i.y)}}}},le={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"svg-canvas-wrapper",style:{width:e.width+"px",height:e.height+"px"}},[n("svg",{attrs:{"font-family":"sans-serif",viewBox:e.x+" "+e.y+" "+e.canvasWidth+" "+e.canvasHeight},on:{mousemove:function(t){t.preventDefault(),function(t){e.$isMobile.any||e.canvasCursorMove(t)}(t)},mousedown:function(t){if(t.target!==t.currentTarget)return null;!function(t){e.$isMobile.any||e.canvasCursorDownSelf(t)}(t)},mouseup:[function(t){if(t.target!==t.currentTarget)return null;!function(t){e.$isMobile.any||e.canvasCursorUpSelf(t)}(t)},function(t){return e.$isMobile.any?"":e.canvasCursorUp(t)}],mousewheel:function(t){t.preventDefault(),function(t){e.$isMobile.any||e.canvasWheel(t)}(t)},touchmove:function(t){t.preventDefault(),function(t){e.$isMobile.any&&e.canvasCursorMove(t)}(t)},touchstart:function(t){if(t.target!==t.currentTarget)return null;!function(t){e.$isMobile.any&&e.canvasCursorDownSelf(t)}(t)},touchend:[function(t){if(t.target!==t.currentTarget)return null;!function(t){e.$isMobile.any&&e.canvasCursorUpSelf(t)}(t)},function(t){return e.$isMobile.any?e.canvasCursorUp(t):""}]}},[e._t("default"),e._v(" "),e.rectangleSelecting?n("SvgRectangle",{attrs:{x:e.selectRectangle.x,y:e.selectRectangle.y,rx:3,ry:3,width:e.selectRectangle.width,height:e.selectRectangle.height,fill:"none",stroke:"blue",strokeDasharray:5,strokeDashoffset:5}}):e._e()],2)])},staticRenderFns:[]},ce=n("VU/8")(ae,le,!1,function(e){n("hBGc")},"data-v-65b2ca5c",null).exports,ue={props:{text:{type:String,required:!0},x:{type:Number,default:0},y:{type:Number,default:0},fontSize:{type:Number,default:10},fill:{type:String,default:"black"},fontWeight:{type:Number,default:500}},methods:{getBBox:function(){return this.$refs.text.getBBox()}}},de={render:function(){var e=this.$createElement;return(this._self._c||e)("text",{ref:"text",attrs:{x:this.x,y:this.y,"font-size":this.fontSize,"font-weight":this.fontWeight,fill:this.fill}},[this._v("\n  "+this._s(this.text)+"\n")])},staticRenderFns:[]},he={components:{SvgText:n("VU/8")(ue,de,!1,null,null,null).exports,SvgRectangle:se},data:function(){return{textWidth:50}},props:{text:{type:String,required:!0},x:{type:Number,default:0},y:{type:Number,default:0},fontSize:{type:Number,default:10},strokeWidth:{type:Number,default:1},stroke:{type:String,default:"black"},fill:{type:String,default:"none"},textFill:{type:String,default:"black"}},computed:{lines:function(){return this.text.split(/\n|\r\n/)},width:function(){return this.textWidth},height:function(){return this.textHeight*this.lines.length+8},textHeight:function(){return this.fontSize+5},textX:function(){return this.x+this.textPaddingX},textY:function(){return this.y},textPaddingX:function(){return 5}},watch:{text:function(){var e=this;this.$nextTick().then(function(){e.adjustTextWidth()})}},mounted:function(){this.adjustTextWidth()},methods:{adjustTextWidth:function(){var e=this.getBBox();this.textWidth=e.width,this.$emit("calcSize",e)},getBBox:function(){var e=this;return{width:this.lines.reduce(function(t,n,i){var o=e.$refs.svgLine[i].getBBox().width;return Math.max(t,o)},46)+2*this.textPaddingX,height:this.height}}}},fe={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("g",[n("SvgRectangle",{attrs:{x:e.x,y:e.y,rx:3,ry:3,width:e.textWidth,height:e.height,"stroke-width":e.strokeWidth,stroke:e.stroke,fill:e.fill}}),e._v(" "),e._l(e.lines,function(t,i){return n("SvgText",{key:i,ref:"svgLine",refInFor:!0,attrs:{x:e.textX,y:e.textY+e.textHeight*(i+1),"font-size":e.fontSize,text:t,fill:e.textFill}})}),e._v(" "),e.text?e._e():n("SvgText",{attrs:{text:"",x:e.textX,y:e.textY+e.textHeight,"font-size":e.fontSize,fill:e.textFill}})],2)},staticRenderFns:[]},ve=n("VU/8")(he,fe,!1,null,null,null).exports,ge={props:{sx:{type:Number,required:!0},sy:{type:Number,required:!0},ex:{type:Number,required:!0},ey:{type:Number,required:!0}},computed:{qx:function(){return 7*this.sx/10+3*this.ex/10},qy:function(){return 1*this.sy/10+9*this.ey/10},cx:function(){return(this.sx+this.ex)/2},cy:function(){return(this.sy+this.ey)/2}},methods:{}},ye={render:function(){var e=this.$createElement;return(this._self._c||e)("path",{attrs:{stroke:"black","stroke-width":"1",fill:"none",d:"M "+this.sx+" "+this.sy+" Q "+this.qx+" "+this.qy+" "+this.ex+" "+this.ey}})},staticRenderFns:[]},me=n("VU/8")(ge,ye,!1,null,null,null).exports,pe={props:{value:{type:String,required:!0},x:{type:Number,default:0},y:{type:Number,default:0},targetKey:{type:String,required:!0}},computed:{_value:{get:function(){return this.value},set:function(e){this.$emit("input",e)}},lines:function(){return this._value.split(/\n|\r\n/)},rows:function(){return Math.min(this.lines.length,3)}},methods:{done:function(){this.$emit("done",{value:this.value,targetKey:this.targetKey})}}},xe={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"float-text-input-wrapper",style:{top:e.y+"px",left:e.x+"px"}},[n("v-text-field",{staticClass:"text-field",attrs:{"multi-line":"","hide-details":"",autofocus:"",rows:e.rows},on:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"esc",27,t.key))return null;e.done(t)},blur:e.done},model:{value:e._value,callback:function(t){e._value=t},expression:"_value"}})],1)},staticRenderFns:[]},_e=n("VU/8")(pe,xe,!1,function(e){n("jo2n")},"data-v-1c3d034e",null).exports,be={data:function(){return{snackbar:!1}},props:{x:{type:Number,default:0},y:{type:Number,default:0},root:{type:Boolean,default:!1}},computed:{},methods:{clickDelete:function(){this.snackbar?(this.$emit("delete"),this.snackbar=!1):this.snackbar=!0}}},we={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"float-edit-menu-wrapper",style:{top:e.y+"px",left:e.x+"px"}},[e.root?e._e():n("v-btn",{staticClass:"list-item",attrs:{icon:"",small:"",outline:"",color:"indigo"},on:{click:function(t){e.$emit("editText")}}},[n("v-icon",[e._v("edit")])],1),e.root?e._e():n("v-btn",{staticClass:"list-item",attrs:{icon:"",small:"",outline:"",color:"indigo"},on:{click:function(t){e.$emit("addBrother")}}},[n("v-icon",[e._v("add")])],1),n("v-btn",{staticClass:"list-item",attrs:{icon:"",small:"",outline:"",color:"indigo"},on:{click:function(t){e.$emit("addChild")}}},[n("v-icon",[e._v("subdirectory_arrow_right")])],1),e.root?e._e():n("v-btn",{staticClass:"list-item",attrs:{icon:"",small:"",outline:"",color:"indigo"},on:{click:e.clickDelete}},[n("v-icon",[e._v("delete")])],1),e._v(" "),n("v-snackbar",{attrs:{bottom:"",right:"",timeout:2e3},model:{value:e.snackbar,callback:function(t){e.snackbar=t},expression:"snackbar"}},[e._v("\n    One more click to delete.\n  ")])],1)},staticRenderFns:[]},Ce=n("VU/8")(be,we,!1,function(e){n("g9s3")},"data-v-e4cb815c",null).exports,ke={props:{step:{type:Number,default:.1},min:{type:Number,default:-10},max:{type:Number,default:10},scaleRate:{type:Number,default:1}}},Se={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"scale-tool-wrapper"},[n("div",{staticClass:"scale-slider-wrapper"},[n("v-slider",{attrs:{"hide-details":"",step:e.step,min:e.min,max:e.max,value:e.scaleRate},on:{input:function(t){return e.$emit("changeScaleRate",t)}}})],1),e._v(" "),n("v-btn",{staticClass:"pan-button",attrs:{icon:"",small:"",outline:"",color:"indigo"},on:{click:function(t){e.$emit("clearZoom")}}},[n("v-icon",[e._v("center_focus_weak")])],1)],1)},staticRenderFns:[]},Ne={components:{SvgCanvas:ce,SvgRectangle:se,SvgTextRectangle:ve,SvgConnector:me,FloatTextInput:_e,FloatEditMenu:Ce,ScaleToolBox:n("VU/8")(ke,Se,!1,function(e){n("S6Nt")},"data-v-8aafaba6",null).exports},data:function(){return{x:0,y:0,scaleRate:0,nodeCursorDownStart:0,nodeCursorClickLast:0,nodeSizes:{},beforeMoveP:null,movingNodePositions:{},editTextTarget:null,editingText:"",editMenuTarget:null,adjustParentWithMovingTimer:null,insertInformationOfMovingNodes:null}},props:{width:{type:Number,default:400},height:{type:Number,default:400},nodes:{type:Object,required:!0,validator:function(e){return Y in e}},selectedNodes:{type:Object,default:function(){return{}}},fileAuthority:{type:Object,default:function(){return{}}},user:{type:Object,default:function(){return{}}},defaultNodeProps:{type:Object,default:function(){return{}}}},mounted:function(){var e=this;this.$nextTick().then(function(){e.clearZoom()})},computed:{canWrite:function(){if(this.fileAuthority){var e=this.fileAuthority[this.user.uid];return e&&e.write}return!1},ROOT_NODE:function(){return Y},NODE_MARGIN_Y:function(){return G},MIN_SCALE_RATE:function(){return Math.min(Math.log(this.scaleCoveringAllNode)/Math.log(1.1)-3,-5)},MAX_SCALE_RATE:function(){return 25},viewRectangle:function(){return{x:this.x,y:this.y,width:this.width/this.scale,height:this.height/this.scale}},nodeCount:function(){return $()(this.nodes).length},movingNodeCount:function(){return $()(this.movingNodePositions).length},scale:{get:function(){return Math.pow(1.1,this.scaleRate)},set:function(e){var t=Math.log(e)/Math.log(1.1);t<this.MIN_SCALE_RATE&&(t=this.MIN_SCALE_RATE),t>this.MAX_SCALE_RATE&&(t=this.MAX_SCALE_RATE),this.scaleRate=t}},editTextTargetNode:function(){return this.nodes[this.editTextTarget]},editTextTargetPosition:function(){return this.getFloatMenuPosition(this.editTextTarget,120)},editMenuTargetPosition:function(){return this.getFloatMenuPosition(this.editMenuTarget,80)},nodePositions:function(){var e=this,t={width:50,height:20},n={};return $()(this.nodes).forEach(function(i){n[i]=e.nodeSizes[i]||B()({},t)}),function(e){var t=e.nodes,n=e.sizes,i=e.parentKey,o={};o[i]={x:0,y:0};var r={};return a({nodes:t,sizes:n,familySizes:r,parentKey:i}),s({nodes:t,sizes:n,familySizes:r,parentKey:i,positions:o}),o}({nodes:this.nodes,sizes:n,parentKey:Y})},connectors:function(){return function(e){var t=e.nodes,n=e.positions,i=e.sizes,o={};return $()(t).forEach(function(e){var r=t[e],s=n[e],a=i[e];r.children.forEach(function(t){var r=n[t],l=i[t];if(a&&l){var c=r.x+l.width/2<s.x+a.width/2;o[e+"-"+t]={sx:s.x+a.width-q,sy:s.y+a.height/2,ex:c?r.x+l.width:r.x,ey:r.y+l.height/2}}})}),o}({nodes:this.nodes,positions:this.nodePositions,sizes:this.nodeSizes})},connectorOfMovingNodes:function(){var e=this.insertInformationOfMovingNodes;if(e){var t=$()(this.movingNodePositions)[0];return function(e){var t=e.nodes,n=e.sizes,i=e.positions,o=e.targetKey,r=e.newParentKey,s=e.newChildOrder,a=t[r];if(a.children[s]!==o){var l=i[r],c=n[r],u={sx:l.x+c.width-q,sy:l.y+c.height/2};if(0===a.children.length)return B()({},u,{ex:u.sx+q+X,ey:u.sy});var d=s,h=a.children.indexOf(o);if(-1!==h&&h<d&&d++,a.children.length>d){var f=i[a.children[d]];if(d>0){var v=a.children[d-1],g=i[v],y=n[v],m=g.y+y.height;return B()({},u,{ex:f.x,ey:(f.y+m)/2})}return B()({},u,{ex:f.x,ey:f.y-G/2})}var p=a.children[d-1],x=i[p],_=n[p];return B()({},u,{ex:x.x,ey:x.y+_.height+G/2})}}({nodes:this.nodes,sizes:this.nodeSizes,positions:this.nodePositions,targetKey:t,newParentKey:e.parentKey,newChildOrder:e.order})}},rectangleCoveringAllNode:function(){var e=function(e){var t=e.positions,n=e.sizes,i=$()(t).filter(function(e){return t[e]&&n[e]});if(0===i.length)return{x:0,y:0,width:0,height:0};var o=i.reduce(function(e,n){return{x:Math.min(e.x,t[n].x),y:Math.min(e.y,t[n].y)}},{x:t[i[0]].x,y:t[i[0]].y}),r=i.reduce(function(e,i){return{width:Math.max(e.width,t[i].x+n[i].width-o.x),height:Math.max(e.height,t[i].y+n[i].height-o.y)}},{width:n[i[0]].width,height:n[i[0]].height});return{x:o.x,y:o.y,width:r.width,height:r.height}}({positions:this.nodePositions,sizes:this.nodeSizes}),t=Math.max(e.width,e.height)<300?200:Math.max(100-Math.pow(this.nodeCount,2),20);return e.x-=t,e.y-=t,e.width+=2*t,e.height+=2*t,e},scaleCoveringAllNode:function(){var e=this.rectangleCoveringAllNode,t=this.width/e.width,n=this.height/e.height;return Math.min(t,n)},isMultiSelect:function(){return $()(this.selectedNodes).length>1}},watch:{scale:function(){var e=this.$refs.svgCanvas.getPostionAfterChangeScale(this.scale);this.x=e.x,this.y=e.y},selectedNodes:function(e,t){var n=$()(e);-1===n.indexOf(this.editMenuTarget)&&(this.editMenuTarget=null),-1===n.indexOf(this.editTextTarget)&&(this.editTextTarget=null)}},methods:{getFocus:function(){this.$refs.svgCanvasWrapper.focus()},move:function(e){var t=e.x,n=e.y;this.x=t,this.y=n},zoom:function(e){var t=e.scale,n=e.x,i=e.y;this.scale=t,this.x=n,this.y=i},clearZoom:function(){var e=this;return new H.a(function(t){var n=e.rectangleCoveringAllNode,i=e.width/n.width,o=e.height/n.height;e.scale=Math.min(i,o),e.$nextTick().then(function(){e.x=n.x,e.y=n.y,i<o?e.y-=(e.height/e.scale-n.height)/2:e.x-=(e.width/e.scale-n.width)/2,e.$nextTick().then(function(){t()})})})},nodeCursorDown:function(e,t){if(this.nodeCursorDownStart=Date.now(),t!==Y){var n=ne(e),i=this.$refs.svgCanvas.svg2dom(this.nodePositions[t]);this.beforeMoveP={x:n.x+i.x,y:n.y+i.y},this.movingNodePositions=j()({},t,B()({},this.nodePositions[t]))}},nodeCursorUp:function(e,t){var n=t.shift,i=void 0!==n&&n,o=Date.now();o-this.nodeCursorDownStart<300&&(o-this.nodeCursorClickLast<300?this.readyEditText(e):this.toggleSelectNode(e,i),this.nodeCursorClickLast=o)},canvasCursorMove:function(e){var t=this;if(this.beforeMoveP){var n=ne(e),i=this.$refs.svgCanvas.dom2svgScale({x:this.beforeMoveP.x-n.x,y:this.beforeMoveP.y-n.y});$()(this.movingNodePositions).forEach(function(e){t.movingNodePositions[e].x-=i.x,t.movingNodePositions[e].y-=i.y}),this.beforeMoveP=B()({},n),this.adjustParentWithMovingTimer||(this.adjustParentWithMovingTimer=setTimeout(function(){t.adjustParentWithMoving(),t.adjustParentWithMovingTimer=null},250))}},canvasCursorUp:function(e){this.adjustParentWithMoving(!0),this.beforeMoveP=null,this.movingNodePositions={}},adjustParentWithMoving:function(e){if(this.movingNodeCount>0){var t=$()(this.movingNodePositions)[0],n=function(e){var t=e.nodes,n=e.sizes,o=e.positions,s=e.targetKey,a=e.movingPositions,u={},d=c({nodes:t,parentKey:s});$()(t).forEach(function(e){l({nodes:t,childKey:e})&&(u[e]={x:o[e].x,y:o[e].y,width:n[e].width,height:n[e].height})});var h={x:a[s].x,y:a[s].y,width:n[s].width,height:n[s].height},v=r({rectangles:u,point:{x:h.x+h.width/4,y:h.y+h.height/2}});if(d.indexOf(v)>-1||v===s)return t;var g=t[v],y=u[v],m=i(h);if((0===g.children.length||1===g.children.length&&-1===g.children.indexOf(m))&&y.x+y.width/2<h.x)return f({nodes:t,targetKey:s,newParentKey:v,order:0});var p=m.y<y.y+y.height/2,x=l({nodes:t,childKey:v}),_=t[x].children.indexOf(v);return f({nodes:t,targetKey:s,newParentKey:x,order:_+(p?0:1)})}({nodes:this.nodes,sizes:this.nodeSizes,positions:this.nodePositions,targetKey:t,movingPositions:this.movingNodePositions}),o=l({nodes:n,childKey:t}),s=n[o];this.insertInformationOfMovingNodes={parentKey:o,order:s.children.indexOf(t)},e&&(this.$emit("updateNodes",n),this.insertInformationOfMovingNodes=null)}},clearSelect:function(){this.$emit("clearSelect"),this.editMenuTarget=null,this.editTextTarget=null,this.editingText=null},clearSelectNode:function(e){this.$emit("setSelectedNodes",B()({},this.selectedNodes,j()({},e,!1)));var t=$()(this.selectedNodes).filter(function(t){return t!==e});1===t.length?this.editMenuTarget=t[0]:this.editMenuTarget=null,this.editTextTarget=null,this.editingText=null},selectNode:function(e,t){this.canWrite&&(t?this.$emit("setSelectedNodes",B()({},this.selectedNodes,j()({},e,!0))):this.$emit("setSelectedNodes",j()({},e,!0)),this.editMenuTarget=e,this.moveViewToCoverSelectedNode(e))},toggleSelectNode:function(e,t){this.selectedNodes[e]?this.clearSelectNode(e):this.selectNode(e,t)},moveViewToCoverSelectedNode:function(e){var t=this;if(this.nodes[e]){var n=this.nodePositions[e],i=this.nodeSizes[e];if(i){var o=this.viewRectangle,r=30/this.scale;i.width>o.width||n.x<o.x+r?this.x=n.x-r:n.x+i.width>o.x+o.width-r&&(this.x=n.x+i.width+r-o.width),i.height>o.height||n.y<o.y+r?this.y=n.y-r:n.y+i.height>o.y+o.height-r&&(this.y=n.y+i.height+3*r-o.height)}else this.$nextTick().then(function(){t.moveViewToCoverSelectedNode(e)})}},readyEditText:function(e){this.canWrite&&(this.selectNode(e),this.editTextTarget=e,this.editingText=this.nodes[e]?this.nodes[e].text:"",this.editMenuTarget=null)},doneEditText:function(e){var t=e.value,n=e.targetKey,i=this.nodes[n];if(i){var o=B()({},i,{text:t});this.$emit("updateNodes",j()({},n,o)),this.selectNode(n),this.editTextTarget=null,this.editingText=null,this.$refs.svgCanvasWrapper.focus()}},createNode:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.editMenuTarget===Y&&(t=!1);var n=x.database().ref().push().getKey(),i=t?function(e){var t=e.nodes,n=e.brotherKey,i=e.newKey,o=void 0===i?"key_"+Math.random():i,r=l({nodes:t,childKey:n}),s=u({nodes:t,parentKey:r,newKey:o}),a=s[r];a.children.pop();var c=a.children.indexOf(n);return a.children.splice(c+1,0,o),s}({nodes:this.nodes,brotherKey:this.editMenuTarget,newKey:n}):u({nodes:this.nodes,parentKey:this.editMenuTarget,newKey:n});i[n]=B()({},i[n],this.defaultNodeProps),this.$emit("updateNodes",i),this.$nextTick().then(function(){e.readyEditText(n)})},deleteNode:function(){if(this.isMultiSelect){var e=function(e){var t=e.nodes,n=e.deleteKeys,i=B()({},t);return $()(n).reduce(function(e,t){if(t in e)return e;var n=d({nodes:i,deleteKey:t});return i=$()(i).reduce(function(e,t){return null!==n[t]&&(e[t]=n[t]||i[t]),e},{}),B()({},e,n)},{})}({nodes:this.nodes,deleteKeys:this.selectedNodes});this.$emit("updateNodes",e),this.clearSelect()}else{var t=this.editMenuTarget;if(t){var n=l({nodes:this.nodes,childKey:t});n&&this.selectNode(n);var i=d({nodes:this.nodes,deleteKey:t});this.$emit("updateNodes",i)}}},calcSize:function(e){var t=e.key,n=e.size;g.a.set(this.nodeSizes,t,n)},keydownEnter:function(){this.editMenuTarget&&!this.editTextTarget&&this.createNode(!0)},keydownShiftEnter:function(){this.editMenuTarget&&!this.editTextTarget&&this.createNode()},keydownSpace:function(){this.editMenuTarget&&this.readyEditText(this.editMenuTarget)},keydownDelete:function(){this.deleteNode()},moveSelect:function(e){var t=this.editMenuTarget;if(t){var n=function(e){var t=e.nodes,n=e.to,i=null,o=e.targetKey,r=t[o];if(r)if("right"===n)r.children.length>0&&(i=r.children[0]);else{var s=l({nodes:t,childKey:o});if(s){var a=t[s];if("left"===n&&(i=s),"down"===n){var c=(a.children.indexOf(o)+1)%a.children.length;i=a.children[c]}if("up"===n){var u=a.children.indexOf(o)-1;u=u<0?a.children.length-1:u,i=a.children[u]}}}return i}({nodes:this.nodes,to:e,targetKey:t});n&&this.selectNode(n)}},changeOrder:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=function(e){var t=e.nodes,n=e.childKey,i=e.dif,o=l({nodes:t,childKey:n});if(!o)return null;var r=t[o],s=r.children.indexOf(n),a=s+i;a=a<0?r.children.length-1:a,a%=r.children.length;var c=h(r);return c.children.splice(s,1),c.children.splice(a,0,n),B()({},t,j()({},o,c))}({nodes:this.nodes,childKey:this.editMenuTarget,dif:e?-1:1});this.$emit("updateNodes",t)},mousewheel:function(e){this.$refs.svgCanvas.canvasWheel(e)},getFloatMenuPosition:function(e,t){var n=this.nodePositions[e],i=this.nodeSizes[e],o=(this.viewRectangle.y+this.viewRectangle.height-this.y)*this.scale,r=(n.y-this.y)*this.scale,s=(n.y-this.y+i.height)*this.scale,a=Math.min(s,o-t)+5;a=Math.max(a,r);var l=(this.viewRectangle.x-this.x)*this.scale,c=(n.x-this.x)*this.scale,u=(n.x+i.width-this.x)*this.scale,d=Math.max(c,l+20)-5;return d=Math.min(d,u),{x:d,y:a}},selectRectangle:function(e){var t=this,n=$()(this.nodes).reduce(function(n,i){var o={x:t.nodePositions[i].x,y:t.nodePositions[i].y,width:t.nodeSizes[i].width,height:t.nodeSizes[i].height};return function(e){var t=e.outer,n=e.inner;return!(t.x>n.x||t.y>n.y||t.x+t.width<n.x+n.width||t.y+t.height<n.y+n.height)}({outer:e,inner:o})&&(n[i]=!0),n},{});this.$emit("setSelectedNodes",B()({},this.selectedNodes,n))}}},Ee={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"map-canvas-wrapper"},[n("div",{ref:"svgCanvasWrapper",staticClass:"canvas-wrapper",attrs:{tabindex:e.canWrite?"1":""},on:{click:e.getFocus,keydown:[function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key)?t.target!==t.currentTarget?null:t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:void e.keydownEnter(t):null},function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key)?t.target!==t.currentTarget?null:t.shiftKey?t.ctrlKey||t.altKey||t.metaKey?null:void e.keydownShiftEnter(t):null:null},function(t){return"button"in t||!e._k(t.keyCode,"up",38,t.key)?t.target!==t.currentTarget?null:t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:void e.moveSelect("up"):null},function(t){return"button"in t||!e._k(t.keyCode,"down",40,t.key)?t.target!==t.currentTarget?null:t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:void e.moveSelect("down"):null},function(t){return"button"in t||!e._k(t.keyCode,"left",37,t.key)?t.target!==t.currentTarget?null:"button"in t&&0!==t.button?null:t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:void e.moveSelect("left"):null},function(t){return"button"in t||!e._k(t.keyCode,"right",39,t.key)?t.target!==t.currentTarget?null:"button"in t&&2!==t.button?null:t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:void e.moveSelect("right"):null},function(t){return"button"in t||!e._k(t.keyCode,"up",38,t.key)?t.target!==t.currentTarget?null:t.shiftKey?t.ctrlKey||t.altKey||t.metaKey?null:void e.changeOrder(!0):null:null},function(t){return"button"in t||!e._k(t.keyCode,"down",40,t.key)?t.target!==t.currentTarget?null:t.shiftKey?t.ctrlKey||t.altKey||t.metaKey?null:void e.changeOrder():null:null},function(t){return"button"in t||!e._k(t.keyCode,"space",32,t.key)?t.target!==t.currentTarget?null:t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:void e.keydownSpace(t):null},function(t){return"button"in t||!e._k(t.keyCode,"delete",[8,46],t.key)?t.target!==t.currentTarget?null:t.shiftKey?t.ctrlKey||t.altKey||t.metaKey?null:void e.keydownDelete(t):null:null},function(t){return"button"in t||90===t.keyCode?t.target!==t.currentTarget?null:t.ctrlKey?t.shiftKey||t.altKey||t.metaKey?null:void e.$emit("undo"):null:null},function(t){return"button"in t||90===t.keyCode?t.target!==t.currentTarget?null:t.metaKey?t.ctrlKey||t.shiftKey||t.altKey?null:void e.$emit("undo"):null:null},function(t){return"button"in t||90===t.keyCode?t.target!==t.currentTarget?null:t.ctrlKey&&t.shiftKey?t.altKey||t.metaKey?null:void e.$emit("redo"):null:null},function(t){return"button"in t||90===t.keyCode?t.target!==t.currentTarget?null:t.metaKey&&t.shiftKey?t.ctrlKey||t.altKey?null:void e.$emit("redo"):null:null}]}},[e.canWrite?e._e():n("v-icon",{staticClass:"lock-button"},[e._v("lock")]),e._v(" "),n("SvgCanvas",{ref:"svgCanvas",attrs:{x:e.x,y:e.y,width:e.width,height:e.height,scale:e.scale},on:{move:e.move,zoom:e.zoom,selectRectangle:e.selectRectangle,click:e.clearSelect},nativeOn:{mousemove:function(t){!function(t){e.$isMobile.any||e.canvasCursorMove(t)}(t)},mouseup:function(t){!function(t){e.$isMobile.any||e.canvasCursorUp(t)}(t)},touchmove:function(t){!function(t){e.$isMobile.any&&e.canvasCursorMove(t)}(t)},touchend:function(t){!function(t){e.$isMobile.any&&e.canvasCursorUp(t)}(t)}}},[e._l(e.connectors,function(e,t){return n("SvgConnector",{key:t,attrs:{sx:e.sx,sy:e.sy,ex:e.ex,ey:e.ey}})}),e._v(" "),e.connectorOfMovingNodes?n("g",{staticClass:"inserting-marker"},[n("SvgConnector",{attrs:{sx:e.connectorOfMovingNodes.sx,sy:e.connectorOfMovingNodes.sy,ex:e.connectorOfMovingNodes.ex,ey:e.connectorOfMovingNodes.ey}}),e._v(" "),n("SvgRectangle",{attrs:{x:e.connectorOfMovingNodes.ex,y:e.connectorOfMovingNodes.ey-e.NODE_MARGIN_Y/3/2,rx:5,ry:5,width:50,height:e.NODE_MARGIN_Y/3,stroke:"none",fill:"blue"}})],1):e._e(),e._v(" "),e._l(e.nodes,function(t,i){return n("SvgTextRectangle",{key:i,ref:"node_"+i,refInFor:!0,staticClass:"mind-node",class:{"moving-origin":e.movingNodePositions[i]},attrs:{x:e.nodePositions[i].x,y:e.nodePositions[i].y,text:i===e.editTextTarget?e.editingText:t.text,strokeWidth:e.selectedNodes[i]?2:1,stroke:e.selectedNodes[i]?"blue":"black",fill:t.backgroundColor,textFill:t.color},on:{calcSize:function(t){return e.calcSize({key:i,size:t})}},nativeOn:{mousedown:function(t){t.preventDefault(),function(t){e.canWrite&&(e.$isMobile.any||e.nodeCursorDown(t,i))}(t)},mouseup:function(t){t.preventDefault(),function(t){e.canWrite&&(e.$isMobile.any||e.nodeCursorUp(i,{shift:t.shiftKey}))}(t)},touchstart:function(t){t.preventDefault(),function(t){e.canWrite&&e.$isMobile.any&&e.nodeCursorDown(t,i)}(t)},touchend:function(t){t.preventDefault(),function(t){e.canWrite&&e.$isMobile.any&&e.nodeCursorUp(i,{shift:t.shiftKey})}(t)}}})}),e._v(" "),e._l(e.movingNodePositions,function(t,i){return n("SvgTextRectangle",{key:"moving_"+i,staticClass:"mind-node moving-copy",attrs:{x:t.x,y:t.y,text:e.nodes[i].text,strokeWidth:e.selectedNodes[i]?2:1,stroke:e.selectedNodes[i]?"blue":"black",fill:e.nodes[i].backgroundColor,textFill:e.nodes[i].color}})})],2)],1),e._v(" "),n("div",{staticClass:"scale-tool"},[n("ScaleToolBox",{attrs:{min:e.MIN_SCALE_RATE,max:e.MAX_SCALE_RATE,step:.1,scaleRate:e.scaleRate},on:{changeScaleRate:function(t){return e.scaleRate=t},clearZoom:e.clearZoom}})],1),e._v(" "),e.editTextTargetNode&&0===e.movingNodeCount&&!e.isMultiSelect?n("FloatTextInput",{attrs:{x:e.editTextTargetPosition.x,y:e.editTextTargetPosition.y,targetKey:e.editTextTarget},on:{done:e.doneEditText},nativeOn:{mousewheel:function(t){t.preventDefault(),function(t){e.$isMobile.any||e.mousewheel(t)}(t)}},model:{value:e.editingText,callback:function(t){e.editingText=t},expression:"editingText"}}):e._e(),e._v(" "),e.editMenuTarget&&0===e.movingNodeCount&&!e.isMultiSelect?n("FloatEditMenu",{attrs:{root:e.editMenuTarget===e.ROOT_NODE,x:e.editMenuTargetPosition.x,y:e.editMenuTargetPosition.y},on:{editText:function(t){e.readyEditText(e.editMenuTarget)},addBrother:function(t){e.createNode(!0)},addChild:function(t){e.createNode(!1)},delete:e.deleteNode},nativeOn:{mousewheel:function(t){t.preventDefault(),function(t){e.$isMobile.any||e.mousewheel(t)}(t)}}}):e._e()],1)},staticRenderFns:[]},Te=n("VU/8")(Ne,Ee,!1,function(e){n("ix4Q")},"data-v-13b0a982",null).exports,Ae="NODES",Ke="SELECTED_NODES",Oe="FILE_KEY",Me="INITIAL_LOADING",Re="DISCONNECT",De="LOAD_NODES",Fe="UPDATE_NODES",Pe="UNDO_NODES",Le="REDO_NODES",Ie="SET_SELECTED_NODES",Ue="CLEAR_SELECT",ze="RESCUE_CONFRICT",je="UPDATE_NODES",We="SET_SELECTED_NODES",He="SET_FILE_KEY",Ve="CLEAR_NODES",Be="SET_INITIAL_LOADING",Qe="PUSH_UNDO_STACK",$e="POP_UNDO_STACK",Xe="POP_REDO_STACK",Ge="CLEAR_STACKS",Ze="CLEAR_UNDO_STACKS",qe="CLEAR_REDO_STACKS",Ye="FILES",Je="FILE_AUTHORITIES",et="SHARED_FILES",tt="SHARED_FILE_AUTHORITIES",nt="LOAD_FILE",it="LOAD_FILES",ot="UPDATE_FILES",rt="CREATE_FILE",st="DELETE_FILES",at="INVITE_USER",lt="UPDATE_FILES",ct="UPDATE_FILE_AUTHORITIES",ut="UPDATE_SHARED_FILES",dt="UPDATE_SHARED_FILE_AUTHORITIES",ht="CLEAR_FILES",ft="NODE_COLOR",vt="TEXT_COLOR",gt="SET_NODE_COLOR",yt="SET_TEXT_COLOR",mt="SET_NODE_COLOR",pt="SET_TEXT_COLOR",xt={components:{MapCanvas:Te},data:function(){return{message:""}},props:{fileKey:{type:String,required:!0}},computed:m()({},Object(C.c)("layouts",{leftDrawer:D}),Object(C.c)("user",{user:k}),Object(C.c)("nodes",{nodes:Ae,selectedNodes:Ke,initialLoading:Me}),Object(C.c)("files",{fileAuthorities:Je,files:Ye}),Object(C.c)("settings",{nodeColor:ft,textColor:vt}),{canvasWidth:function(){return this.$window.width>=1264&&this.leftDrawer?this.$window.width-300-20:this.$window.width-20},canvasHeight:function(){return this.$window.height-48},fileAuthority:function(){return this.fileAuthorities[this.fileKey]},defaultNodeProps:function(){return{backgroundColor:this.nodeColor,color:this.textColor}},file:function(){return this.files[this.fileKey]},loaded:function(){return!this.initialLoading||this.file&&this.file.nodeCount<1},snackbar:{get:function(){return!!this.message},set:function(e){this.message=e?this.message:""}}}),mounted:function(){this.loadNodes({fileKey:this.fileKey}),this.loadFile({key:this.fileKey})},destroyed:function(){this.disconnect()},methods:m()({},Object(C.b)("nodes",{disconnect:Re,updateNodes:Fe,setSelectedNodes:Ie,clearSelect:Ue,loadNodes:De,_undo:Pe,_redo:Le}),Object(C.b)("files",{loadFile:nt}),{undo:function(){var e=this;this._undo().catch(function(t){e.message=t.message})},redo:function(){var e=this;this._redo().catch(function(t){e.message=t.message})}})},_t={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.loaded?n("MapCanvas",{attrs:{width:e.canvasWidth,height:e.canvasHeight,nodes:e.nodes,selectedNodes:e.selectedNodes,fileAuthority:e.fileAuthority,user:e.user,defaultNodeProps:e.defaultNodeProps},on:{updateNodes:function(t){return e.updateNodes({nodes:t})},setSelectedNodes:function(t){return e.setSelectedNodes({selectedNodes:t})},clearSelect:e.clearSelect,undo:e.undo,redo:e.redo}}):e._e(),e._v(" "),n("v-snackbar",{attrs:{bottom:"",right:"",color:"error",timeout:4e3},model:{value:e.snackbar,callback:function(t){e.snackbar=t},expression:"snackbar"}},[e._v("\n    "+e._s(e.message)+"\n  ")])],1)},staticRenderFns:[]},bt=n("VU/8")(xt,_t,!1,function(e){n("lC8a")},"data-v-f65dbcf4",null).exports,wt={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-layout",{attrs:{row:"","justify-center":""}},[n("v-dialog",{attrs:{"max-width":"300"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[n("v-btn",{attrs:{slot:"activator",icon:""},slot:"activator"},[n("v-icon",[e._v("share")])],1),e._v(" "),n("v-card",[n("v-card-title",{staticClass:"headline"},[e._v("Share this file")]),e._v(" "),n("v-card-text",[n("form",[n("v-text-field",{attrs:{label:"E-mail","error-messages":e.emailErrors,required:""},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}}),e._v(" "),n("v-checkbox",{attrs:{label:"Read only"},model:{value:e.readOnly,callback:function(t){e.readOnly=t},expression:"readOnly"}}),e._v(" "),n("v-btn",{on:{click:e.submit}},[e._v("invite")])],1)])],1)],1)],1)},staticRenderFns:[]},Ct={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-layout",{attrs:{row:"","justify-center":""}},[n("v-dialog",{attrs:{width:"400px"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[n("v-btn",{attrs:{slot:"activator",icon:""},slot:"activator"},[n("v-icon",[e._v("help")])],1),e._v(" "),n("v-card",[n("v-card-title",[n("span",{staticClass:"headline"},[e._v("Help")])]),e._v(" "),n("v-list",{attrs:{"two-line":"",subheader:""}},[n("v-divider"),e._v(" "),n("v-subheader",[e._v("Select")]),e._v(" "),n("v-list-tile",{attrs:{avatar:""}},[n("v-list-tile-content",[n("v-list-tile-title",[e._v("\n              Move focus\n            ")]),e._v(" "),n("v-list-tile-sub-title",[n("code",[e._v("Arrow")])])],1)],1),e._v(" "),n("v-list-tile",{attrs:{avatar:""}},[n("v-list-tile-content",[n("v-list-tile-title",[e._v("\n              Multiple\n            ")]),e._v(" "),n("v-list-tile-sub-title",[n("code",[e._v("Shift")]),e._v(" + "),n("code",[e._v("Click")])])],1)],1),e._v(" "),n("v-list-tile",{attrs:{avatar:""}},[n("v-list-tile-content",[n("v-list-tile-title",[e._v("\n              Rectangle\n            ")]),e._v(" "),n("v-list-tile-sub-title",[n("code",[e._v("Shift")]),e._v(" + "),n("code",[e._v("Drag")])])],1)],1),e._v(" "),n("v-divider"),e._v(" "),n("v-subheader",[e._v("Selecting a Node")]),e._v(" "),n("v-list-tile",{attrs:{avatar:""}},[n("v-list-tile-content",[n("v-list-tile-title",[e._v("\n              Create a younger node\n            ")]),e._v(" "),n("v-list-tile-sub-title",[n("code",[e._v("Enter")])])],1)],1),e._v(" "),n("v-list-tile",{attrs:{avatar:""}},[n("v-list-tile-content",[n("v-list-tile-title",[e._v("\n              Create a child node\n            ")]),e._v(" "),n("v-list-tile-sub-title",[n("code",[e._v("Shift")]),e._v(" + "),n("code",[e._v("Enter")])])],1)],1),e._v(" "),n("v-list-tile",{attrs:{avatar:""}},[n("v-list-tile-content",[n("v-list-tile-title",[e._v("\n              Delete a node\n            ")]),e._v(" "),n("v-list-tile-sub-title",[n("code",[e._v("Shift")]),e._v(" + "),n("code",[e._v("Delete")])])],1)],1),e._v(" "),n("v-list-tile",{attrs:{avatar:""}},[n("v-list-tile-content",[n("v-list-tile-title",[e._v("\n              Edit text\n            ")]),e._v(" "),n("v-list-tile-sub-title",[n("code",[e._v("Space")])])],1)],1),e._v(" "),n("v-list-tile",{attrs:{avatar:""}},[n("v-list-tile-content",[n("v-list-tile-title",[e._v("\n              Complete editing text\n            ")]),e._v(" "),n("v-list-tile-sub-title",[n("code",[e._v("Escape")])])],1)],1),e._v(" "),n("v-list-tile",{attrs:{avatar:""}},[n("v-list-tile-content",[n("v-list-tile-title",[e._v("\n              Change the parent\n            ")]),e._v(" "),n("v-list-tile-sub-title",[n("code",[e._v("Drag")])])],1)],1),e._v(" "),n("v-list-tile",{attrs:{avatar:""}},[n("v-list-tile-content",[n("v-list-tile-title",[e._v("\n              Switch order\n            ")]),e._v(" "),n("v-list-tile-sub-title",[n("code",[e._v("Shift")]),e._v(" + "),n("code",[e._v("Up or Down")])])],1)],1),e._v(" "),n("v-divider"),e._v(" "),n("v-subheader",[e._v("History")]),e._v(" "),n("v-list-tile",{attrs:{avatar:""}},[n("v-list-tile-content",[n("v-list-tile-title",[e._v("\n              Undo\n            ")]),e._v(" "),n("v-list-tile-sub-title",[n("code",[e._v("Control")]),e._v(" + "),n("code",[e._v("Z")]),e._v(" , "),n("code",[e._v("Command")]),e._v(" + "),n("code",[e._v("Z")])])],1)],1),e._v(" "),n("v-list-tile",{attrs:{avatar:""}},[n("v-list-tile-content",[n("v-list-tile-title",[e._v("\n              Redo\n            ")]),e._v(" "),n("v-list-tile-sub-title",[n("code",[e._v("Control")]),e._v(" + "),n("code",[e._v("Shift")]),e._v(" + "),n("code",[e._v("Z")]),e._v(" , "),n("code",[e._v("Command")]),e._v(" + "),n("code",[e._v("Shift")]),e._v(" + "),n("code",[e._v("Z")])])],1)],1),e._v(" "),n("v-divider")],1),e._v(" "),n("v-card-actions",[n("v-spacer"),e._v(" "),n("v-btn",{attrs:{color:"black darken-1",flat:"flat"},on:{click:function(t){e.dialog=!1}}},[e._v("Close")])],1)],1)],1)],1)},staticRenderFns:[]},kt={components:{InviteUserDialog:n("VU/8")({data:function(){return{dialog:!1,email:"",readOnly:!1}},props:{},computed:{emailErrors:function(){return[]}},methods:{submit:function(){this.$emit("invite",{email:this.email,readOnly:this.readOnly}),this.dialog=!1}}},wt,!1,function(e){n("c/DQ")},"data-v-6a74d05c",null).exports,MapHelpDialog:n("VU/8")({data:function(){return{dialog:!1}}},Ct,!1,function(e){n("nDx3")},"data-v-1ceee14f",null).exports},computed:m()({},Object(C.c)("nodes",{fileKey:Oe}),Object(C.c)("files",{fileAuthorities:Je}),Object(C.c)("user",{user:k}),{canShare:function(){var e=this.user.uid,t=this.fileAuthorities[this.fileKey];if(t){if(t.public)return!1;return t.users[e].write}return!1}}),methods:m()({},Object(C.b)("files",{inviteUser:at}),{invite:function(e){var t=e.email,n=e.readOnly;this.inviteUser({fileKey:this.fileKey,email:t,readOnly:n})}})},St={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"map-menu"},[this.canShare?t("InviteUserDialog",{on:{invite:this.invite}}):this._e(),this._v(" "),t("MapHelpDialog")],1)},staticRenderFns:[]},Nt=n("VU/8")(kt,St,!1,function(e){n("ILwI")},"data-v-3b2a640a",null).exports,Et=n("Zzkc"),Tt={components:{ColorPicker:Et.Swatches,MapCanvas:Te},data:function(){return{renderCanvas:!1,showNodeColorPicker:!1,showTextColorPicker:!1}},props:{nodes:{type:Object,required:!0,validator:function(e){return Y in e}},file:{type:Object,required:!0},nodeColor:{type:String,default:"#87cefa"},textColor:{type:String,default:"#000000"}},computed:{canvasWidth:function(){return 1024},canvasHeight:function(){return 1024}},methods:{printSvg:function(){var e=this;this.renderCanvas=!0,this.$nextTick().then(function(){var t=e.$refs.mapCanvas;t.clearZoom().then(function(){var n=t.$refs.svgCanvas.$el,i=(new XMLSerializer).serializeToString(n);e.downloadText(i,e.file.name),e.renderCanvas=!1})})},downloadText:function(e,t){var n=new Blob([e],{type:"text/plain"});if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(n,t);else{var i=document.createElement("a");i.href=URL.createObjectURL(n),i.target="_blank",i.download=t,i.click()}}}},At={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-tabs",{attrs:{grow:""}},[n("v-tabs-bar",{staticClass:"grey lighten-4",attrs:{light:""}},[n("v-tabs-item",{staticClass:"primary--text",attrs:{href:"#left-drawer-edit"}},[n("v-icon",[e._v("mode_edit")])],1),e._v(" "),n("v-tabs-item",{staticClass:"primary--text",attrs:{href:"#left-drawer-file"}},[n("v-icon",[e._v("insert_drive_file")])],1),e._v(" "),n("v-tabs-slider",{attrs:{color:"yellow"}})],1),e._v(" "),n("v-tabs-items",[n("v-tabs-content",{attrs:{id:"left-drawer-edit"}},[n("v-list",[n("v-list-tile",{style:{background:e.nodeColor},on:{click:function(t){e.showNodeColorPicker=!e.showNodeColorPicker}}},[n("v-list-tile-action",[n("v-icon",{style:{color:e.textColor}},[e._v("palette")])],1),e._v(" "),n("v-list-tile-content",[n("v-list-tile-title",{style:{color:e.textColor}},[n("b",[e._v("Node Color")])])],1)],1),e._v(" "),e.showNodeColorPicker?n("li",{staticClass:"picker-box"},[n("ColorPicker",{attrs:{value:e.nodeColor},on:{input:function(t){return e.$emit("changeNodeColor",t.hex)}}})],1):e._e(),e._v(" "),n("v-list-tile",{style:{background:e.nodeColor},on:{click:function(t){e.showTextColorPicker=!e.showTextColorPicker}}},[n("v-list-tile-action",[n("v-icon",{style:{color:e.textColor}},[e._v("palette")])],1),e._v(" "),n("v-list-tile-content",[n("v-list-tile-title",{style:{color:e.textColor}},[n("b",[e._v("Text Color")])])],1)],1),e._v(" "),e.showTextColorPicker?n("li",{staticClass:"picker-box"},[n("ColorPicker",{attrs:{value:e.textColor},on:{input:function(t){return e.$emit("changeTextColor",t.hex)}}})],1):e._e()],1)],1),e._v(" "),n("v-tabs-content",{attrs:{id:"left-drawer-file"}},[n("v-list",[n("v-list-tile",{on:{click:e.printSvg}},[n("v-list-tile-action",[n("v-icon",[e._v("file_download")])],1),e._v(" "),n("v-list-tile-content",[n("v-list-tile-title",[e._v("SVG")])],1)],1),e._v(" "),e.renderCanvas?n("MapCanvas",{ref:"mapCanvas",staticClass:"map-canvas",attrs:{nodes:e.nodes,width:e.canvasWidth,height:e.canvasHeight}}):e._e(),e._v(" "),n("v-divider"),e._v(" "),n("v-list-tile",{on:{click:function(t){e.$emit("repairFile")}}},[n("v-list-tile-action",[n("v-icon",[e._v("autorenew")])],1),e._v(" "),n("v-list-tile-content",[n("v-list-tile-title",[e._v("Repair file")])],1)],1)],1)],1)],1)],1)},staticRenderFns:[]},Kt={components:{MapLeftDrawer:n("VU/8")(Tt,At,!1,function(e){n("TcNv")},"data-v-1d36a405",null).exports},computed:m()({},Object(C.c)("nodes",{nodes:Ae,selectedNodes:Ke,fileKey:Oe}),Object(C.c)("settings",{nodeColor:ft,textColor:vt}),Object(C.c)("files",{files:Ye}),{file:function(){return this.files[this.fileKey]}}),methods:m()({},Object(C.b)("nodes",{updateNodes:Fe,_repairFile:ze}),Object(C.b)("settings",{setNodeColor:gt,setTextColor:yt}),{changeSelectedNodesProps:function(e){var t=this,n=$()(this.selectedNodes);if(n.length>0){var i=n.reduce(function(n,i){return n[i]=B()({},t.nodes[i],e),n},{});this.updateNodes({nodes:i})}},changeNodeColor:function(e){this.setNodeColor({nodeColor:e}),this.changeSelectedNodesProps({backgroundColor:e})},changeTextColor:function(e){this.setTextColor({textColor:e}),this.changeSelectedNodesProps({color:e})},repairFile:function(){this._repairFile().then(function(){location.reload()})}})},Ot={render:function(){var e=this.$createElement,t=this._self._c||e;return this.file?t("MapLeftDrawer",{attrs:{nodes:this.nodes,file:this.file,nodeColor:this.nodeColor,textColor:this.textColor},on:{changeNodeColor:this.changeNodeColor,changeTextColor:this.changeTextColor,repairFile:this.repairFile}}):this._e()},staticRenderFns:[]},Mt=n("VU/8")(Kt,Ot,!1,function(e){n("7aKY")},"data-v-22256c46",null).exports,Rt={data:function(){return{max25chars:function(e){return e.length<=25||"Input too long!"},tmp:"",searchText:"",pagination:{page:1,rowsPerPage:10,sortBy:"created",descending:!0},headers:[{text:"Name",align:"left",value:"name"},{text:"Count",value:"nodeCount"},{text:"Updated",value:"updated"},{text:"Created",value:"created"},{text:"",value:"",sortable:!1}],snackbar:!1,dataKind:"workSpace"}},props:{files:{type:Object,default:function(){return{}}},fileAuthorities:{type:Object,default:function(){return{}}},sharedFiles:{type:Object,default:function(){return{}}},sharedFileAuthorities:{type:Object,default:function(){return{}}},user:{type:Object,default:function(){return{}}}},watch:{pagination:{handler:function(){},deep:!0}},computed:{pages:function(){return this.pagination.rowsPerPage?Math.ceil(this.fileList.length/this.pagination.rowsPerPage):0},currentFiles:function(){return"shared"===this.dataKind?this.sharedFiles:this.files},currentFileAuthorities:function(){return"shared"===this.dataKind?this.sharedFileAuthorities:this.fileAuthorities},fileList:function(){var e=this;return $()(this.currentFiles).map(function(t){return B()({},e.currentFiles[t],{key:t})})},canWrite:function(){var e=this,t=this.user.uid;return $()(this.currentFileAuthorities).reduce(function(n,i){var o=e.currentFileAuthorities[i];if(o)if(o.public)n[i]=o.public.write;else{var r=o.users[t];n[i]=r.write}else n[i]=!1;return n},{})},hideEditTools:function(){return"shared"===this.dataKind}},methods:{changeName:function(e){var t=e.key,n=e.name,i=j()({},t,B()({},this.currentFiles[t],{name:n}));this.$emit("changeName",{files:i})},createFile:function(){this.$emit("createFile",{file:{name:"untitled"}}),this.pagination.sortBy="created",this.pagination.descending=!0},deleteFile:function(e){if(this.snackbar){var t=j()({},e,null);this.$emit("deleteFiles",{files:t}),this.snackbar=!1}else this.snackbar=!0}}},Dt={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"work-space-component"},[n("v-card",[n("v-card-title",[n("v-flex",{attrs:{xs6:""}},[n("v-select",{staticClass:"data-kind-select",attrs:{items:[{text:"Work space",value:"workSpace"},{text:"Shared",value:"shared"}],"single-line":"",bottom:"","hide-details":""},model:{value:e.dataKind,callback:function(t){e.dataKind=t},expression:"dataKind"}})],1),e._v(" "),n("div",{staticClass:"header-buttons"},[e.hideEditTools?e._e():n("v-btn",{attrs:{dark:"",fab:"",small:"",color:"green"},on:{click:e.createFile}},[n("v-icon",[e._v("add")])],1)],1)],1)],1),e._v(" "),n("v-card",[n("v-data-table",{attrs:{headers:e.headers,items:e.fileList,pagination:e.pagination,"hide-actions":"","must-sort":"",expand:""},on:{"update:pagination":function(t){e.pagination=t}},scopedSlots:e._u([{key:"items",fn:function(t){return[n("td",{staticClass:"text-xs-left"},[e.canWrite[t.item.key]?n("v-btn",{attrs:{dark:"",fab:"",small:"",color:"blue"},on:{click:function(n){e.$router.push({name:"Map",params:{fileKey:t.item.key}})}}},[n("v-icon",[e._v("edit")])],1):n("v-btn",{attrs:{dark:"",fab:"",small:"",color:"blue"},on:{click:function(n){e.$router.push({name:"Map",params:{fileKey:t.item.key}})}}},[n("v-icon",[e._v("navigate_next")])],1),e._v(" "),e.canWrite[t.item.key]?n("v-edit-dialog",{attrs:{lazy:""}},[n("span",{staticClass:"name elevation-1"},[e._v(e._s(t.item.name))]),e._v(" "),n("v-text-field",{attrs:{slot:"input",label:"Edit","single-line":"",counter:"",rules:[e.max25chars],value:t.item.name},on:{change:function(n){return e.changeName({key:t.item.key,name:n})}},slot:"input"})],1):n("span",{staticClass:"name"},[e._v(e._s(t.item.name))])],1),e._v(" "),n("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.nodeCount))]),e._v(" "),n("td",{staticClass:"text-xs-right"},[e._v(e._s(new Date(t.item.created).toLocaleString()))]),e._v(" "),n("td",{staticClass:"text-xs-right"},[e._v(e._s(new Date(t.item.updated).toLocaleString()))]),e._v(" "),n("td",{staticClass:"delete-button-cell"},[e.hideEditTools?e._e():n("v-btn",{attrs:{dark:"",fab:"",small:"",color:"black",outline:""},on:{click:function(n){e.deleteFile(t.item.key)}}},[n("v-icon",[e._v("delete")])],1)],1)]}}])}),e._v(" "),n("div",{staticClass:"text-xs-center pt-2"},[n("v-pagination",{attrs:{length:e.pages},model:{value:e.pagination.page,callback:function(t){e.$set(e.pagination,"page",t)},expression:"pagination.page"}})],1)],1),e._v(" "),n("v-snackbar",{attrs:{bottom:"",right:"",timeout:2e3},model:{value:e.snackbar,callback:function(t){e.snackbar=t},expression:"snackbar"}},[e._v("\n    One more click to delete.\n  ")])],1)},staticRenderFns:[]},Ft={components:{WorkSpace:n("VU/8")(Rt,Dt,!1,function(e){n("7XHC")},"data-v-5744d663",null).exports},computed:m()({},Object(C.c)("files",{files:Ye,fileAuthorities:Je,sharedFiles:et,sharedFileAuthorities:tt}),Object(C.c)("user",{user:k})),mounted:function(){this.loadFiles()},methods:m()({},Object(C.b)("files",{loadFiles:it,updateFiles:ot,createFile:rt,deleteFiles:st}))},Pt={render:function(){var e=this.$createElement;return(this._self._c||e)("WorkSpace",{attrs:{files:this.files,fileAuthorities:this.fileAuthorities,sharedFiles:this.sharedFiles,sharedFileAuthorities:this.sharedFileAuthorities,user:this.user},on:{changeName:this.updateFiles,createFile:this.createFile,deleteFiles:this.deleteFiles}})},staticRenderFns:[]},Lt=n("VU/8")(Ft,Pt,!1,function(e){n("dtl8")},"data-v-35231456",null).exports;g.a.use(R.a);var It,Ut,zt,jt,Wt,Ht,Vt,Bt,Qt,$t,Xt,Gt,Zt=new R.a({mode:"history",routes:[{path:"/",component:U,children:[{path:"",name:"WorkSpace",components:{content:Lt}},{path:"map/:fileKey",name:"Map",components:{content:bt,headerIconList:Nt,leftDrawer:Mt},props:{content:!0}}]}]}),qt={namespaced:!0,state:{leftDrawer:!1},modules:{},actions:j()({},F,function(e,t){var n=t.leftDrawer;e.commit(P,{leftDrawer:n})}),mutations:j()({},P,function(e,t){var n=t.leftDrawer;e.leftDrawer=n}),getters:j()({},D,function(e){return e.leftDrawer})},Yt=function(e,t){var n=t.nodes,i=e.state.fileKey,o=$()(n).reduce(function(e,t){return e["/nodes/"+i+"/"+t]=n[t],e},{});return o["/files/"+i+"/updated"]=x.database.ServerValue.TIMESTAMP,o["/files/"+i+"/nodeCount"]=$()(B()({},e.state.nodes,n)).length,x.database().ref().update(o)},Jt=function(e){return x.database().ref("nodes/"+e.state.fileKey).off()},en=function(e,t){var n=t.fileKey,i=x.database().ref("nodes/"+n);return i.on("child_added",function(t){var n=j()({},t.key,J(t.val()));e.commit(je,{nodes:n}),e.state.initialLoading&&e.commit(Be,{initialLoading:!1})}),i.on("child_changed",function(t){var n=j()({},t.key,J(t.val()));e.commit(je,{nodes:n})}),i.on("child_removed",function(t){var n=j()({},t.key,null);e.commit(je,{nodes:n})}),H.a.resolve()},tn=(It={},j()(It,Re,function(e){e.state.fileKey&&Jt(e),e.commit(Ve)}),j()(It,De,function(e,t){var n=t.fileKey;e.dispatch(Re),e.commit(He,{fileKey:n}),e.commit(Be,{initialLoading:!0}),en(e,{fileKey:n})}),j()(It,Fe,function(e,t){var n=t.nodes,i=function(e){var t=e.nodes,n=e.updatedNodes;return $()(n).reduce(function(e,i){var o=t[i],r=n[i];return o&&r?ee(o,r)||(e[i]=r):e[i]=r,e},{})}({nodes:e.state.nodes,updatedNodes:n});0!==$()(i).length&&(e.commit(Qe,{nodes:i}),e.commit(je,{nodes:i}),Yt(e,{nodes:i}))}),j()(It,Pe,function(e){return new H.a(function(t,n){var i=e.state.undoStacks;if(!(i.length>0))return n(new Error("No undo history"));var o=i[i.length-1];if(o){var r=B()({},e.state.nodes,o);for(var s in r)r[s]||delete r[s];if(v({nodes:r}))return e.commit(Ze),n(new Error("Failed to undo. Others may edit and conflicted."));e.commit($e),e.commit(je,{nodes:o}),Yt(e,{nodes:o})}return t()})}),j()(It,Le,function(e){return new H.a(function(t,n){var i=e.state.redoStacks;if(!(i.length>0))return n(new Error("No redo history"));var o=i[i.length-1];if(o){var r=B()({},e.state.nodes,o);for(var s in r)r[s]||delete r[s];if(v({nodes:r}))return e.commit(qe),n(new Error("Failed to redo. Others may edit and conflicted."));e.commit(Xe),e.commit(je,{nodes:o}),Yt(e,{nodes:o})}return t()})}),j()(It,ze,function(e){if(!v({nodes:e.state.nodes}))return H.a.resolve();var t=function(e){var t=e.nodes;return $()(t).reduce(function(e,n){if(n!==Y&&!l({nodes:t,childKey:n}))return e;var i=t[n].children.filter(function(e){if(t[e])return!0});return e[n]=B()({},t[n],{children:i}),e},{})}({nodes:e.state.nodes});return e.commit(Ge),e.commit(We,{}),e.commit(je,{nodes:t}),Yt(e,{nodes:t})}),j()(It,Ie,function(e,t){var n=t.selectedNodes;e.commit(We,{selectedNodes:n})}),j()(It,Ue,function(e){e.commit(We,{})}),It),nn=(Ut={},j()(Ut,je,function(e,t){var n=t.nodes;$()(n).forEach(function(t){n[t]?g.a.set(e.nodes,t,n[t]):g.a.delete(e.nodes,t)}),0===$()(e.nodes).length&&(e.nodes=te()),e.selectedNodes=$()(e.selectedNodes).reduce(function(t,n){return e.nodes[n]&&(t[n]=!0),t},{})}),j()(Ut,We,function(e,t){var n=t.selectedNodes,i=void 0===n?{}:n;e.selectedNodes=$()(i).reduce(function(e,t){return i[t]&&(e[t]=!0),e},{})}),j()(Ut,He,function(e,t){var n=t.fileKey;e.fileKey=n}),j()(Ut,Ve,function(e){e.fileKey=null,e.nodes=te(),e.selectedNodes={},e.undoStacks=[],e.redoStacks=[]}),j()(Ut,Be,function(e,t){var n=t.initialLoading;e.initialLoading=n}),j()(Ut,Qe,function(e,t){var n=t.nodes,i=$()(n).reduce(function(t,n){return t[n]=e.nodes[n]?h(e.nodes[n]):null,t},{});e.undoStacks.push(B()({},i)),e.redoStacks=[]}),j()(Ut,$e,function(e){if(e.undoStacks.length>0){var t=e.undoStacks.pop(),n=$()(t).reduce(function(t,n){return t[n]=e.nodes[n]?h(e.nodes[n]):null,t},{});e.redoStacks.push(n)}}),j()(Ut,Xe,function(e){if(e.redoStacks.length>0){var t=e.redoStacks.pop(),n=$()(t).reduce(function(t,n){return t[n]=e.nodes[n]?h(e.nodes[n]):null,t},{});e.undoStacks.push(n)}}),j()(Ut,Ge,function(e){e.undoStacks=[],e.redoStacks=[]}),j()(Ut,Ze,function(e){e.undoStacks=[]}),j()(Ut,qe,function(e){e.redoStacks=[]}),Ut),on=(zt={},j()(zt,Ae,function(e){return e.nodes}),j()(zt,Ke,function(e){return e.selectedNodes}),j()(zt,Oe,function(e){return e.fileKey}),j()(zt,Me,function(e){return e.initialLoading}),zt),rn={namespaced:!0,state:{fileKey:null,nodes:j()({},Y,J()),selectedNodes:{},initialLoading:!0,undoStacks:[],redoStacks:[]},modules:{},actions:tn,mutations:nn,getters:on},sn=(jt={},j()(jt,N,function(e){e.commit(A,!0),x.auth().onAuthStateChanged(function(t){e.commit(A,!0),t?(e.commit(T,t),e.commit(A,!t)):x.auth().getRedirectResult().then(function(t){e.commit(T,t.user),e.commit(A,!t.user)}).catch(function(e){console.log(e.code,e.message)})})}),j()(jt,E,function(e){return new H.a(function(t,n){e.commit(A,!0),x.auth().signOut().then(function(){e.commit(T,null),t()}).catch(function(t){e.commit(T,null),n(t)})})}),jt),an=(Wt={},j()(Wt,T,function(e,t){t?(e.user={uid:t.uid,displayName:t.displayName,email:t.email,photoURL:t.photoURL},e.authorityLoading=!1):(e.user=null,e.authorityLoading=!0)}),j()(Wt,A,function(e,t){e.authorityLoading=t}),Wt),ln=(Ht={},j()(Ht,k,function(e,t){return e.user}),j()(Ht,S,function(e,t){return e.authorityLoading}),Ht),cn={namespaced:!0,state:{user:function(e){return B()({},{uid:null,displayName:null,email:null,photoURL:null},e)}(),authorityLoading:!0},modules:{},actions:sn,mutations:an,getters:ln},un={namespaced:!0,state:{files:{},fileAuthorities:{},sharedFiles:{},sharedFileAuthorities:{}},modules:{},actions:(Vt={},j()(Vt,nt,function(e,t){var n=t.key;x.database().ref("/file_authorities/"+n).once("value").then(function(t){var i=t.val();e.commit(ct,{fileAuthorities:j()({},n,i)})}),x.database().ref("/files/"+n).once("value").then(function(t){var i=t.val();e.commit(lt,{files:j()({},n,i)})})}),j()(Vt,it,function(e,t){e.commit(ht);var n=x.auth().currentUser.uid;x.database().ref("/work_spaces/"+n).once("value").then(function(t){var n=t.val();if(n){var i=n.files||{},o=n.invited_files||{};$()(i).forEach(function(t){x.database().ref("/file_authorities/"+t).once("value").then(function(n){var i=n.val();e.commit(ct,{fileAuthorities:j()({},t,i)})}),x.database().ref("/files/"+t).once("value").then(function(n){var i=n.val();e.commit(lt,{files:j()({},t,i)})})}),$()(o).forEach(function(t){x.database().ref("/file_authorities/"+t).once("value").then(function(n){var i=n.val();e.commit(dt,{sharedFileAuthorities:j()({},t,i)})}),x.database().ref("/files/"+t).once("value").then(function(n){var i=n.val();e.commit(ut,{sharedFiles:j()({},t,i)})})})}})}),j()(Vt,ot,function(e,t){var n=t.files,i=void 0===n?{}:n,o=$()(i).reduce(function(e,t){return e["/files/"+t]=i[t],e},{});x.database().ref().update(o).then(function(){e.commit(lt,{files:i})})}),j()(Vt,rt,function(e,t){var n=t.file,i=void 0===n?{}:n,o=x.auth().currentUser.uid,r=x.database().ref().child("file_authorities").push().key;x.database().ref("/file_authorities/"+r+"/users/"+o).set({write:!0}).then(function(){e.commit(ct,{fileAuthorities:j()({},r,j()({},o,{write:!0}))});var t=B()({},function(e){return B()({},{name:"file a",nodeCount:0,created:"created",updated:"updated"},e)}(i),{created:x.database.ServerValue.TIMESTAMP,updated:x.database.ServerValue.TIMESTAMP}),n={};return n["/files/"+r]=t,n["/work_spaces/"+o+"/files/"+r]=!0,x.database().ref().update(n)}).then(function(){return x.database().ref("/files/"+r).once("value")}).then(function(t){e.commit(lt,{files:j()({},r,t.val())})})}),j()(Vt,st,function(e,t){var n=t.files,i=x.auth().currentUser.uid,o=$()(n).reduce(function(e,t){return e["/work_spaces/"+i+"/files/"+t]=null,e},{});x.database().ref().update(o).then(function(){return e.commit(lt,{files:n}),H.a.resolve()})}),j()(Vt,at,function(e,t){var n=t.email,i=t.fileKey,o=t.readOnly,r=x.database().ref().child("file_invitations").push().key;x.database().ref("/file_invitations/"+i+"/"+r).set({email:n,write:!o}).then(function(){})}),Vt),mutations:(Bt={},j()(Bt,lt,function(e,t){var n=t.files;$()(n).forEach(function(t){n[t]?g.a.set(e.files,t,n[t]):g.a.delete(e.files,t)})}),j()(Bt,ct,function(e,t){var n=t.fileAuthorities;$()(n).forEach(function(t){n[t]?g.a.set(e.fileAuthorities,t,n[t]):g.a.delete(e.fileAuthorities,t)})}),j()(Bt,ut,function(e,t){var n=t.sharedFiles;$()(n).forEach(function(t){n[t]?g.a.set(e.sharedFiles,t,n[t]):g.a.delete(e.sharedFiles,t)})}),j()(Bt,dt,function(e,t){var n=t.sharedFileAuthorities;$()(n).forEach(function(t){n[t]?g.a.set(e.sharedFileAuthorities,t,n[t]):g.a.delete(e.sharedFileAuthorities,t)})}),j()(Bt,ht,function(e){e.files={},e.fileAuthorities={},e.sharedFiles={},e.sharedFileAuthorities={}}),Bt),getters:(Qt={},j()(Qt,Ye,function(e){return e.files}),j()(Qt,Je,function(e){return e.fileAuthorities}),j()(Qt,et,function(e){return e.sharedFiles}),j()(Qt,tt,function(e){return e.sharedFileAuthorities}),Qt)},dn={namespaced:!0,state:{nodeColor:"#B3E5FC",textColor:"#000000"},modules:{},actions:($t={},j()($t,gt,function(e,t){var n=t.nodeColor;e.commit(mt,{nodeColor:n})}),j()($t,yt,function(e,t){var n=t.textColor;e.commit(pt,{textColor:n})}),$t),mutations:(Xt={},j()(Xt,mt,function(e,t){var n=t.nodeColor;e.nodeColor=n}),j()(Xt,pt,function(e,t){var n=t.textColor;e.textColor=n}),Xt),getters:(Gt={},j()(Gt,ft,function(e){return e.nodeColor}),j()(Gt,vt,function(e){return e.textColor}),Gt)};g.a.use(C.a);var hn=new C.a.Store({strict:!1,namespaced:!0,state:{},modules:{files:un,layouts:qt,nodes:rn,settings:dn,user:cn},mutations:{}}),fn=n("3EgV"),vn=n.n(fn),gn={install:function(e){var t={scrollX:0,scrollY:0,width:0,height:0},n=function(){t.width=document.documentElement.clientWidth,t.height=document.documentElement.clientHeight};window.addEventListener("resize",n),n(),e.util.defineReactive(e.prototype,"$window",t)}};g.a.use(gn);var yn=n("Sst2"),mn={install:function(e){e.util.defineReactive(e.prototype,"$isMobile",yn)}};g.a.use(mn),window.trackJs||(window.trackJs={track:function(){console.log("trackJs",arguments)}}),g.a.config.errorHandler=function(e,t,n){t.$options.propsData&&console.log("Props passed to component",t.$options.propsData);var i="Error in component: <"+t.$options.name+" />\n";n&&(i+="Error occurred during lifecycle hook: "+n+"\n"),console.log(i),window.trackJs.track(e)};n("o8dz"),n("7zck"),n("5myX");g.a.use(vn.a),g.a.config.productionTip=!1,new g.a({el:"#app",router:Zt,store:hn,template:"<App/>",components:{App:M}})},S6Nt:function(e,t){},TcNv:function(e,t){},"Wk/c":function(e,t){},"c/DQ":function(e,t){},dtl8:function(e,t){},g9s3:function(e,t){},hBGc:function(e,t){},ix4Q:function(e,t){},jo2n:function(e,t){},lC8a:function(e,t){},nDx3:function(e,t){},o8dz:function(e,t){},vLcZ:function(e,t){},"y/zs":function(e,t){e.exports="data:image/png;base64,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"}},["NHnr"]);
//# sourceMappingURL=app.ba7dbc39978964eae59d.js.map